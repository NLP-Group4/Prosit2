"""
CRUD router for {{ entity.name }}.
"""
import uuid

from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session

from app.database import get_db
from app import crud, schemas
{% if auth_enabled %}
from app.auth import get_current_user
from app.models import UserAccount
{% endif %}

router = APIRouter()


@router.post("/", response_model=schemas.{{ entity.name }}Response, status_code=status.HTTP_201_CREATED)
def create_{{ entity_singular }}(
    item: schemas.{{ entity.name }}Create,
    db: Session = Depends(get_db),
    {% if auth_enabled %}current_user: UserAccount = Depends(get_current_user),{% endif %}
):
    return crud.create_{{ entity_singular }}_item(db=db, item=item)


@router.get("/", response_model=list[schemas.{{ entity.name }}Response])
def list_{{ entity.table_name }}(
    skip: int = 0,
    limit: int = 100,
    db: Session = Depends(get_db),
    {% if auth_enabled %}current_user: UserAccount = Depends(get_current_user),{% endif %}
):
    return crud.get_{{ entity.table_name }}_list(db=db, skip=skip, limit=limit)


@router.get("/{item_id}", response_model=schemas.{{ entity.name }}Response)
def get_{{ entity_singular }}(
    item_id: uuid.UUID,
    db: Session = Depends(get_db),
    {% if auth_enabled %}current_user: UserAccount = Depends(get_current_user),{% endif %}
):
    db_item = crud.get_{{ entity_singular }}_item(db=db, item_id=item_id)
    if db_item is None:
        raise HTTPException(status_code=404, detail="{{ entity.name }} not found")
    return db_item


@router.put("/{item_id}", response_model=schemas.{{ entity.name }}Response)
def update_{{ entity_singular }}(
    item_id: uuid.UUID,
    item: schemas.{{ entity.name }}Update,
    db: Session = Depends(get_db),
    {% if auth_enabled %}current_user: UserAccount = Depends(get_current_user),{% endif %}
):
    db_item = crud.update_{{ entity_singular }}_item(db=db, item_id=item_id, item=item)
    if db_item is None:
        raise HTTPException(status_code=404, detail="{{ entity.name }} not found")
    return db_item


@router.delete("/{item_id}", status_code=status.HTTP_204_NO_CONTENT)
def delete_{{ entity_singular }}(
    item_id: uuid.UUID,
    db: Session = Depends(get_db),
    {% if auth_enabled %}current_user: UserAccount = Depends(get_current_user),{% endif %}
):
    success = crud.delete_{{ entity_singular }}_item(db=db, item_id=item_id)
    if not success:
        raise HTTPException(status_code=404, detail="{{ entity.name }} not found")
