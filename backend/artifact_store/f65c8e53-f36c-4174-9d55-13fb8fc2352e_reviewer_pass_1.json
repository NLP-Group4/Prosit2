{"files": [{"path": "app/main.py", "content": "from fastapi import FastAPI\nfrom app import routes\nfrom app.database import create_db_and_tables\n\napp = FastAPI(title=\"Todo API\")\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\napp.include_router(routes.router)"}, {"path": "app/database.py", "content": "from typing import Generator\n\nfrom sqlmodel import Session, SQLModel, create_engine\n\nDATABASE_URL = \"postgresql://user:password@db:5432/todo_db\"\n\nengine = create_engine(DATABASE_URL, echo=True)\n\ndef create_db_and_tables():\n    SQLModel.metadata.create_all(engine)\n\ndef get_session() -> Generator[Session, None, None]:\n    with Session(engine) as session:\n        yield session"}, {"path": "app/models.py", "content": "from datetime import datetime, timezone\nfrom typing import Optional\n\nfrom sqlmodel import Field, SQLModel\n\n\nclass Task(SQLModel, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    title: str = Field(index=True, unique=True, nullable=False)\n    description: Optional[str] = None\n    completed: bool = Field(default=False, nullable=False)\n    created_at: datetime = Field(default_factory=lambda: datetime.now(timezone.utc), nullable=False)\n    updated_at: datetime = Field(default_factory=lambda: datetime.now(timezone.utc), nullable=False)\n\n    class Config:\n        json_schema_extra = {\n            \"example\": {\n                \"title\": \"Buy groceries\",\n                \"description\": \"Milk, Eggs, Bread, Fruits\",\n                \"completed\": False,\n            }\n        }"}, {"path": "app/schemas.py", "content": "from datetime import datetime\nfrom typing import Optional\n\nfrom pydantic import BaseModel, Field\n\nclass TaskBase(BaseModel):\n    title: str = Field(..., min_length=1, max_length=255)\n    description: Optional[str] = Field(None, max_length=1000)\n    completed: bool = False\n\nclass TaskCreate(TaskBase):\n    pass\n\nclass TaskUpdate(TaskBase):\n    title: Optional[str] = Field(None, min_length=1, max_length=255)\n    completed: Optional[bool] = None\n\nclass TaskRead(TaskBase):\n    id: int\n    created_at: datetime\n    updated_at: datetime\n\n    class Config:\n        from_attributes = True\n\nclass TokenData(BaseModel):\n    username: str"}, {"path": "app/routes.py", "content": "from typing import List\n\nfrom fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlmodel import Session, select\n\nfrom app.database import get_session\nfrom app.models import Task\nfrom app.schemas import TaskCreate, TaskRead, TaskUpdate, TokenData\nfrom app.auth import get_current_user\n\nrouter = APIRouter()\n\n@router.post(\"/tasks/\", response_model=TaskRead, status_code=status.HTTP_201_CREATED)\ndef create_task(\n    task: TaskCreate,\n    session: Session = Depends(get_session),\n    current_user: TokenData = Depends(get_current_user)\n):\n    db_task = Task.from_orm(task)\n    session.add(db_task)\n    session.commit()\n    session.refresh(db_task)\n    return db_task\n\n@router.get(\"/tasks/\", response_model=List[TaskRead])\ndef read_tasks(\n    offset: int = 0,\n    limit: int = 100,\n    session: Session = Depends(get_session),\n    current_user: TokenData = Depends(get_current_user)\n):\n    tasks = session.exec(select(Task).offset(offset).limit(limit)).all()\n    return tasks\n\n@router.get(\"/tasks/{task_id}\", response_model=TaskRead)\ndef read_task(\n    task_id: int,\n    session: Session = Depends(get_session),\n    current_user: TokenData = Depends(get_current_user)\n):\n    task = session.get(Task, task_id)\n    if not task:\n        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail=\"Task not found\")\n    return task\n\n@router.put(\"/tasks/{task_id}\", response_model=TaskRead)\ndef update_task(\n    task_id: int,\n    task: TaskUpdate,\n    session: Session = Depends(get_session),\n    current_user: TokenData = Depends(get_current_user)\n):\n    db_task = session.get(Task, task_id)\n    if not db_task:\n        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail=\"Task not found\")\n    \n    task_data = task.dict(exclude_unset=True)\n    for key, value in task_data.items():\n        setattr(db_task, key, value)\n    \n    session.add(db_task)\n    session.commit()\n    session.refresh(db_task)\n    return db_task\n\n@router.delete(\"/tasks/{task_id}\", status_code=status.HTTP_204_NO_CONTENT)\ndef delete_task(\n    task_id: int,\n    session: Session = Depends(get_session),\n    current_user: TokenData = Depends(get_current_user)\n):\n    task = session.get(Task, task_id)\n    if not task:\n        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail=\"Task not found\")\n    \n    session.delete(task)\n    session.commit()\n    return"}, {"path": "app/auth.py", "content": "from datetime import datetime, timedelta\nfrom typing import Optional\nimport os\n\nfrom fastapi import Depends, HTTPException, status\nfrom fastapi.security import OAuth2PasswordBearer\nfrom jose import JWTError, jwt\nfrom passlib.context import CryptContext\n\nfrom app.schemas import TokenData\n\n# Configuration\nSECRET_KEY = os.getenv(\"SECRET_KEY\", \"super-secret-key-for-dev\")  # Use environment variable\nALGORITHM = \"HS256\"\nACCESS_TOKEN_EXPIRE_MINUTES = 30\n\npwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n\n\ndef verify_password(plain_password, hashed_password):\n    return pwd_context.verify(plain_password, hashed_password)\n\n\ndef get_password_hash(password):\n    return pwd_context.hash(password)\n\n\ndef create_access_token(data: dict, expires_delta: Optional[timedelta] = None):\n    to_encode = data.copy()\n    if expires_delta:\n        expire = datetime.utcnow() + expires_delta\n    else:\n        expire = datetime.utcnow() + timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)\n    to_encode.update({\"exp\": expire})\n    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)\n    return encoded_jwt\n\n\nasync def get_current_user(token: str = Depends(oauth2_scheme)) -> TokenData:\n    credentials_exception = HTTPException(\n        status_code=status.HTTP_401_UNAUTHORIZED,\n        detail=\"Could not validate credentials\",\n        headers={\"WWW-Authenticate\": \"Bearer\"},\n    )\n    try:\n        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])\n        username: str = payload.get(\"sub\")\n        if username is None:\n            raise credentials_exception\n        token_data = TokenData(username=username)\n    except JWTError:\n        raise credentials_exception\n    # In a real application, you would fetch the user from the database here\n    # For this minimal example, we'll just return the TokenData object\n    return token_data"}], "dependencies": ["fastapi", "sqlmodel", "uvicorn", "psycopg2-binary", "python-jose[cryptography]", "passlib[bcrypt]"]}