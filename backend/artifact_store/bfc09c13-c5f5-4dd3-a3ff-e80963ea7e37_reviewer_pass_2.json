{"files": [{"path": "app/main.py", "content": "from contextlib import asynccontextmanager\n\nfrom fastapi import FastAPI\nfrom sqlmodel import SQLModel, create_engine\n\nfrom app import routes\nfrom app.database import engine\n\ndef create_db_and_tables():\n    SQLModel.metadata.create_all(engine)\n\n@asynccontextmanager\nasync def lifespan(app: FastAPI):\n    create_db_and_tables()\n    yield\n\napp = FastAPI(lifespan=lifespan, title=\"Calculator API\")\n\napp.include_router(routes.router)"}, {"path": "app/database.py", "content": "from sqlmodel import create_engine, Session\nfrom typing import Generator\n\nDATABASE_URL = \"sqlite:///./calculator.db\"\n\nengine = create_engine(DATABASE_URL, echo=True)\n\ndef get_session() -> Generator[Session, None, None]:\n    with Session(engine) as session:\n        yield session"}, {"path": "app/models.py", "content": "from datetime import datetime\nfrom typing import Optional\nfrom uuid import UUID, uuid4\nfrom sqlmodel import Field, SQLModel\n\nclass Calculation(SQLModel, table=True):\n    id: Optional[UUID] = Field(default_factory=uuid4, primary_key=True)\n    operand1: float\n    operand2: float\n    operator: str\n    result: Optional[float] = None\n    timestamp: datetime = Field(default_factory=datetime.utcnow, nullable=False)"}, {"path": "app/schemas.py", "content": "from datetime import datetime\nfrom typing import List, Optional\n\nfrom pydantic import BaseModel, Field\n\nclass CalculationRequest(BaseModel):\n    operand1: float\n    operand2: float\n    operator: str = Field(..., pattern=r\"^[+\\-*/]$\")\n\nclass CalculationCreate(CalculationRequest):\n    pass\n\nclass CalculationResult(BaseModel):\n    id: str\n    operand1: float\n    operand2: float\n    operator: str\n    result: Optional[float] = None\n    timestamp: datetime\n\nclass CalculationRead(CalculationResult):\n    pass\n\nclass CalculationResponse(CalculationResult):\n    pass\n\nclass ErrorResponse(BaseModel):\n    detail: str\n\nclass HistoryResponse(BaseModel):\n    calculations: List[CalculationRead]"}, {"path": "app/routes.py", "content": "from typing import List\nfrom uuid import UUID, uuid4\n\nfrom fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlmodel import Session, select\n\nfrom app.database import get_session\nfrom app.models import Calculation\nfrom app.schemas import CalculationCreate, CalculationRead, CalculationResponse\n\nrouter = APIRouter()\n\n@router.post(\"/calculate\", response_model=CalculationResponse, status_code=status.HTTP_201_CREATED)\ndef calculate(\n    calculation_in: CalculationCreate,\n    session: Session = Depends(get_session)\n):\n    operand1 = calculation_in.operand1\n    operand2 = calculation_in.operand2\n    operator = calculation_in.operator\n\n    result: float | None = None\n    if operator == \"+\":\n        result = operand1 + operand2\n    elif operator == \"-\":\n        result = operand1 - operand2\n    elif operator == \"*\":\n        result = operand1 * operand2\n    elif operator == \"/\":\n        if operand2 == 0:\n            raise HTTPException(\n                status_code=status.HTTP_400_BAD_REQUEST,\n                detail=\"Division by zero is not allowed.\"\n            )\n        result = operand1 / operand2\n    else:\n        raise HTTPException(\n            status_code=status.HTTP_400_BAD_REQUEST,\n            detail=\"Invalid operator. Supported operators are +, -, *, /.\"\n        )\n\n    db_calculation = Calculation(\n        id=uuid4(),\n        operand1=operand1,\n        operand2=operand2,\n        operator=operator,\n        result=result\n    )\n    session.add(db_calculation)\n    session.commit()\n    session.refresh(db_calculation)\n\n    return CalculationResponse(\n        id=db_calculation.id,\n        operand1=db_calculation.operand1,\n        operand2=db_calculation.operand2,\n        operator=db_calculation.operator,\n        result=db_calculation.result,\n        timestamp=db_calculation.timestamp\n    )\n\n@router.get(\"/history\", response_model=List[CalculationRead])\ndef get_history(session: Session = Depends(get_session)):\n    calculations = session.exec(select(Calculation)).all()\n    return calculations\n\n@router.get(\"/history/{calculation_id}\", response_model=CalculationRead)\ndef get_calculation_by_id(calculation_id: UUID, session: Session = Depends(get_session)):\n    calculation = session.get(Calculation, calculation_id)\n    if not calculation:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"Calculation not found.\"\n        )\n    return calculation"}], "dependencies": ["fastapi", "sqlmodel", "uvicorn"]}